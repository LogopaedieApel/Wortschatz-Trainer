<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wortschatz-Trainer</title>
    
    <!-- Google Font "Comfortaa" importieren -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- =================================================================
         CSS STYLES (VERSION 3 - MIT HAMBURGER-MENÜ & NEUEM STARTBILDSCHIRM)
         ================================================================= -->
    <style>
        /* === Globale Styles & Variablen === */
        :root {
            --primary-color: #007BFF;
            --primary-hover: #0056b3;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --background-color: #ffffff;
            --font-family: 'Comfortaa', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --border-radius: 8px;
            --box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            
            /* Neue Farben für den Startbildschirm */
            --accent-green-dark: #2a9d8f;
            --accent-green-light: #84c7be;
            --accent-gray: #495057;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            width: 100%;
            font-family: var(--font-family);
            background-color: var(--light-color);
            color: var(--dark-color);
            overflow-x: hidden;
        }
        
        /* === App-Container und Bildschirm-Logik === */
        main {
            min-height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 800px;
            min-height: 100%;
            padding: 1.5rem;
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        /* === Generelle UI-Komponenten === */
        h1 { margin-bottom: 0.5rem; font-size: 2.5rem; }
        h2 { margin-bottom: 2rem; color: var(--secondary-color); font-weight: 400; }
        h3 { margin-bottom: 1.5rem; font-weight: 400; }
        
        .button {
            display: inline-block;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
            background-color: var(--primary-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.2s ease, transform 0.2s ease;
            margin: 5px;
            -webkit-tap-highlight-color: transparent;
        }
        .button:hover { background-color: var(--primary-hover); transform: translateY(-2px); }
        .button-secondary { background-color: var(--secondary-color); }
        .button-secondary:hover { background-color: #5a6268; }
        .button-success { background-color: var(--success-color); }
        .button-success:hover { background-color: #218838; }
        
        /* === Bildschirm 1: Neuer Startbildschirm === */
        #screen-start {
            justify-content: center;
        }
        #welcome-h1 {
            color: var(--accent-green-dark);
            font-size: 3rem;
            font-weight: 700;
        }
        #welcome-h2 {
            color: var(--accent-green-light);
            font-size: 1.8rem;
            margin-top: 0;
        }
        #welcome-h3 {
            color: var(--accent-gray);
            font-size: 1.5rem;
            margin-top: 3rem;
        }
        
        /* === Bildschirm 2: Einstellungen === */
        #screen-settings .settings-container { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 1.5rem; }
        .setting-group { padding: 1rem; border: 1px solid #ddd; border-radius: var(--border-radius); text-align: left; }
        .setting-group label { display: block; font-weight: bold; margin-bottom: 0.5rem; }
        select, .radio-group { width: 100%; padding: 0.5rem; font-size: 1rem; border-radius: 4px; border: 1px solid #ccc; font-family: inherit; }
        .radio-group label { font-weight: normal; margin-right: 1rem; }
        .slider-container { display: flex; align-items: center; gap: 1rem; }
        input[type="range"] { flex-grow: 1; }
        .navigation-buttons { margin-top: 1rem; display: flex; justify-content: space-between; width: 100%; }

        /* === Bildschirm 3: Übung === */
        #screen-exercise { justify-content: space-between; }
        .exercise-header, .exercise-footer { width: 100%; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .exercise-main { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; overflow: hidden; padding: 1rem 0; }
        .display-area { width: 100%; height: 100%; max-height: 50vh; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 2px dashed #ccc; border-radius: var(--border-radius); padding: 1rem; margin-bottom: 1rem; }
        .display-area img { max-width: 100%; max-height: 80%; object-fit: contain; margin-bottom: 1rem; }
        .display-area .word-text { font-size: 2.5rem; font-weight: 700; }
        .diktat-instructions { padding: 2rem; font-size: 1.2rem; color: var(--secondary-color); line-height: 1.6; }
        .speaker-button { font-size: 3rem; background: none; border: none; cursor: pointer; color: var(--primary-color); transition: transform 0.2s; padding: 0.5rem; }
        .speaker-button:hover { transform: scale(1.1); }

        /* === Modal für Anleitung === */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; opacity: 0; transform: scale(0.9); transition: opacity 0.3s ease, transform 0.3s ease; z-index: 1000; padding: 1rem; }
        .modal-content { background: #fff; padding: 2rem; border-radius: var(--border-radius); max-width: 100%; width: 700px; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-close-button { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; background: none; border: none; cursor: pointer; color: var(--secondary-color); }

        /* === HAMBURGER MENÜ & NAVIGATION === */
        .hamburger-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1002;
            width: 40px;
            height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            background: var(--dark-color);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            padding: 8px;
        }
        .hamburger-button .line {
            width: 100%;
            height: 3px;
            background-color: white;
            border-radius: 3px;
            transition: all 0.3s ease-in-out;
        }
        .hamburger-button.active .line1 { transform: rotate(45deg) translate(5px, 5px); }
        .hamburger-button.active .line2 { opacity: 0; }
        .hamburger-button.active .line3 { transform: rotate(-45deg) translate(7px, -7px); }

        .nav-menu {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100%;
            background-color: var(--dark-color);
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            padding-top: 80px;
        }
        .nav-menu.open { transform: translateX(0); }
        .nav-link {
            color: white;
            text-decoration: none;
            font-size: 1.2rem;
            padding: 15px 25px;
            display: block;
            transition: background-color 0.2s;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-family: inherit;
        }
        .nav-link:hover { background-color: var(--primary-color); }
        .nav-link.nav-divider { border-top: 1px solid var(--secondary-color); margin-top: 10px; padding-top: 15px; }

        /* ================================================================
           RESPONSIVE DESIGN ANPASSUNGEN
           ================================================================ */
        @media (max-width: 768px) {
            body { overflow-y: auto; -webkit-text-size-adjust: 100%; }
            main { padding: 0; align-items: flex-start; }
            .screen { border-radius: 0; padding: 1rem; min-height: 100vh; }
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.1rem; margin-bottom: 1.5rem; }

            #welcome-h1 { font-size: 2.2rem; }
            #welcome-h2 { font-size: 1.3rem; }
            #welcome-h3 { font-size: 1.1rem; margin-top: 2rem; }

            .display-area .word-text { font-size: 1.8rem; }
            .diktat-instructions { font-size: 1rem; padding: 1rem; }
            .button { padding: 10px 18px; }
            .exercise-footer .button { font-size: 0.8rem; }
            .hamburger-button { top: 15px; right: 15px; }
        }
        
        @media (max-height: 500px) and (orientation: landscape) {
            main { padding: 0.5rem; }
            .screen { padding: 0.5rem 1rem; justify-content: center; }
            h1 { font-size: 1.5rem; margin-bottom: 0.2rem; }
            h2 { font-size: 0.9rem; margin-bottom: 0.5rem; }
            
            #welcome-h1, #welcome-h2, #welcome-h3 { margin-top: 0.5rem; }

            .exercise-main { flex-direction: row; align-items: center; gap: 1rem; padding: 0.5rem 0; }
            .display-area { max-height: 50vh; margin-bottom: 0; flex-grow: 1; }
            .speaker-button { font-size: 2.5rem; }
            .exercise-header, .exercise-footer { padding: 0.2rem 0; }
        }
    </style>
</head>
<body>

    <!-- Hamburger Menü Button (permanent sichtbar) -->
    <button id="hamburger-btn" class="hamburger-button">
        <span class="line line1"></span>
        <span class="line line2"></span>
        <span class="line line3"></span>
    </button>

    <!-- Seitliches Navigationsmenü (initial versteckt) -->
    <nav id="nav-menu" class="nav-menu">
        <button id="nav-link-learn" class="nav-link">📚 Lernmodus</button>
        <button id="nav-link-test" class="nav-link">✅ Testmodus</button>
        <button id="nav-link-dictation" class="nav-link">✍️ Diktat-Modus</button>
        <button id="nav-link-instructions" class="nav-link nav-divider">ℹ️ Anleitung</button>
    </nav>


    <main>
        <!-- =================================================================
             BILDSCHIRM 1: STARTBILDSCHIRM
             ================================================================= -->
        <div id="screen-start" class="screen">
            <h1 id="welcome-h1">Wortschatz-Trainer</h1>
            <h2 id="welcome-h2">in Bild, Wort und Ton.</h2>
            <h3 id="welcome-h3">Zischlaute</h3>
        </div>

        <!-- =================================================================
             BILDSCHIRM 2: EINSTELLUNGEN
             ================================================================= -->
        <div id="screen-settings" class="screen hidden">
            <h1 id="settings-title">Einstellungen</h1>
            
            <div class="settings-container">
                <div class="setting-group">
                    <label for="item-set-select">1. Lern-Set auswählen:</label>
                    <select id="item-set-select">
                        <!-- Optionen werden von JS dynamisch gefüllt -->
                    </select>
                </div>

                <div id="setting-display-type" class="setting-group">
                    <label>2. Anzeige-Typ:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="displayType" value="image" checked> Nur Bild</label>
                        <label><input type="radio" name="displayType" value="word"> Nur Wort</label>
                        <label><input type="radio" name="displayType" value="image_word"> Bild mit Wort</label>
                    </div>
                </div>

                <div id="setting-sound-delay" class="setting-group">
                    <label for="sound-delay-slider">3. Sound-Verzögerung:</label>
                    <div class="slider-container">
                        <input type="range" id="sound-delay-slider" min="0" max="5" value="1" step="1">
                        <span id="sound-delay-value">1 s</span>
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button id="back-to-start-btn" class="button button-secondary">Zurück zum Start</button>
                    <button id="start-btn" class="button button-success">Starten</button>
                </div>
            </div>
        </div>

        <!-- =================================================================
             BILDSCHIRM 3: ÜBUNGSBILDSCHIRM
             ================================================================= -->
        <div id="screen-exercise" class="screen hidden">
            <div class="exercise-header">
                <span id="item-counter">Item 1 / 10</span>
                <button id="exit-exercise-btn" class="button button-secondary">Beenden</button>
            </div>
            
            <div class="exercise-main">
                <div id="display-area" class="display-area">
                    <!-- Inhalt wird von JS dynamisch gefüllt -->
                </div>
                <button id="speaker-btn" class="speaker-button">🔊</button>
            </div>

            <div class="exercise-footer">
                <button id="prev-item-btn" class="button">Vorheriges</button>
                <button id="show-word-btn" class="button hidden">Wort anzeigen</button>
                <button id="next-item-btn" class="button">Nächstes</button>
            </div>
        </div>
    </main>

    <!-- =================================================================
         MODAL FÜR ANLEITUNG
         ================================================================= -->
    <div id="instructions-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-instructions-btn" class="modal-close-button">×</button>
            <h2>Anleitung</h2>
            <p>Diese Anwendung hilft dir, Wörter und ihre Rechtschreibung zu lernen.</p>
            
            <h3>Modi</h3>
            <p><strong>📚 Lernmodus:</strong> Erkunde die Lern-Items in deinem eigenen Tempo. Navigiere mit den "Nächstes"/"Vorheriges"-Buttons. Klicke auf den Lautsprecher, um das Wort zu hören.</p>
            <p><strong>✅ Testmodus:</strong> Lass dir die Items automatisch nacheinander anzeigen. Der Ton wird nach einer von dir gewählten Verzögerung abgespielt. Ideal, um dein Wissen zu überprüfen.</p>
            <p><strong>✍️ Diktat-Modus:</strong> Höre dir ein Wort an und schreibe es auf. Klicke danach auf "Wort anzeigen", um deine Schreibweise zu kontrollieren.</p>
            
            <h3>Einstellungen</h3>
            <p>Vor jedem Start kannst du das Lern-Set und weitere Optionen wählen:</p>
            <ul>
                <li><strong>Lern-Set:</strong> Wähle die Wortliste (JSON-Datei), mit der du üben möchtest.</li>
                <li><strong>Anzeige-Typ:</strong> (Nur für Lern- & Testmodus) Bestimme, was du sehen willst: nur das Bild, nur das Wort, oder beides zusammen.</li>
                <li><strong>Sound-Verzögerung:</strong> (Nur für Testmodus) Stelle ein, wie viele Sekunden nach Anzeige des Items der Ton abgespielt werden soll.</li>
            </ul>
        </div>
    </div>


    <!-- =================================================================
         JAVASCRIPT LOGIK (Version 3)
         ================================================================= -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- STATE MANAGEMENT ---
        const appState = {
            currentScreen: 'screen-start',
            mode: null, // 'learn', 'test', 'dictation'
            settings: { itemSet: null, displayType: 'image', soundDelay: 1 },
            items: [],
            currentItemIndex: 0,
            isShowingAnswer: false,
            testModeTimer: null,
        };

        // --- DATEN-KONFIGURATION ---
        const ITEM_SETS = [
            { name: "Grundwortschatz Tiere", file: "sets/tiere.json" },
            { name: "Schwierige Wörter Klasse 4", file: "sets/klasse4.json" },
            { name: "Zischlaute", file: "sets/zischlaute.json" },
        ];
        
        // --- DOM ELEMENT REFERENZEN ---
        const screens = {
            start: document.getElementById('screen-start'),
            settings: document.getElementById('screen-settings'),
            exercise: document.getElementById('screen-exercise'),
        };

        const buttons = {
            backToStart: document.getElementById('back-to-start-btn'),
            start: document.getElementById('start-btn'),
            exitExercise: document.getElementById('exit-exercise-btn'),
            prevItem: document.getElementById('prev-item-btn'),
            nextItem: document.getElementById('next-item-btn'),
            showWord: document.getElementById('show-word-btn'),
            speaker: document.getElementById('speaker-btn'),
            closeInstructions: document.getElementById('close-instructions-btn'),
            hamburger: document.getElementById('hamburger-btn'),
        };

        const nav = {
            menu: document.getElementById('nav-menu'),
            learn: document.getElementById('nav-link-learn'),
            test: document.getElementById('nav-link-test'),
            dictation: document.getElementById('nav-link-dictation'),
            instructions: document.getElementById('nav-link-instructions'),
        };

        const settingsElements = {
            title: document.getElementById('settings-title'),
            itemSetSelect: document.getElementById('item-set-select'),
            displayTypeGroup: document.getElementById('setting-display-type'),
            soundDelayGroup: document.getElementById('setting-sound-delay'),
            soundDelaySlider: document.getElementById('sound-delay-slider'),
            soundDelayValue: document.getElementById('sound-delay-value'),
        };

        const exerciseElements = {
            displayArea: document.getElementById('display-area'),
            itemCounter: document.getElementById('item-counter'),
        };
        
        const modal = document.getElementById('instructions-modal');

        // --- FUNKTIONEN ---

        function switchScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if (screens[screenId]) {
                 screens[screenId].classList.remove('hidden');
            }
            appState.currentScreen = screenId;
        }

        function initialize() {
            populateItemSetSelector();
            addEventListeners();
            switchScreen('start');
        }
        
        function populateItemSetSelector() {
            ITEM_SETS.forEach(set => {
                const option = new Option(set.name, set.file);
                settingsElements.itemSetSelect.add(option);
            });
        }
        
        function addEventListeners() {
            // Hamburger & Navigation
            buttons.hamburger.addEventListener('click', toggleNavMenu);
            nav.learn.addEventListener('click', () => selectMode('learn'));
            nav.test.addEventListener('click', () => selectMode('test'));
            nav.dictation.addEventListener('click', () => selectMode('dictation'));
            nav.instructions.addEventListener('click', () => {
                showInstructions();
                closeNavMenu();
            });

            // Einstellungs-Bildschirm
            buttons.backToStart.addEventListener('click', () => switchScreen('start'));
            buttons.start.addEventListener('click', startGame);
            settingsElements.soundDelaySlider.addEventListener('input', (e) => {
                settingsElements.soundDelayValue.textContent = `${e.target.value} s`;
            });

            // Übungs-Bildschirm
            buttons.exitExercise.addEventListener('click', exitExercise);
            buttons.nextItem.addEventListener('click', showNextItem);
            buttons.prevItem.addEventListener('click', showPrevItem);
            buttons.speaker.addEventListener('click', playCurrentSound);
            buttons.showWord.addEventListener('click', showDictationAnswer);
            
            // Anleitung
            buttons.closeInstructions.addEventListener('click', hideInstructions);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) hideInstructions();
            });
        }

        function toggleNavMenu() {
            buttons.hamburger.classList.toggle('active');
            nav.menu.classList.toggle('open');
        }

        function closeNavMenu() {
            buttons.hamburger.classList.remove('active');
            nav.menu.classList.remove('open');
        }
        
        function selectMode(mode) {
            appState.mode = mode;
            setupSettingsScreen();
            switchScreen('settings');
            closeNavMenu();
        }
        
        function setupSettingsScreen() {
            const modeTitles = {
                learn: 'Lernmodus-Einstellungen',
                test: 'Testmodus-Einstellungen',
                dictation: 'Diktat-Einstellungen'
            };
            settingsElements.title.textContent = modeTitles[appState.mode];
            
            const showDisplayType = appState.mode === 'learn' || appState.mode === 'test';
            const showSoundDelay = appState.mode === 'test';
            
            settingsElements.displayTypeGroup.style.display = showDisplayType ? 'block' : 'none';
            settingsElements.soundDelayGroup.style.display = showSoundDelay ? 'block' : 'none';
        }

        async function startGame() {
            const selectedSetFile = settingsElements.itemSetSelect.value;
            if (!selectedSetFile) {
                alert("Bitte wähle zuerst ein Lern-Set aus.");
                return;
            }
            appState.settings.itemSet = selectedSetFile;
            appState.settings.displayType = document.querySelector('input[name="displayType"]:checked').value;
            appState.settings.soundDelay = parseInt(settingsElements.soundDelaySlider.value, 10);
            
            try {
                const response = await fetch(appState.settings.itemSet);
                if (!response.ok) throw new Error(`HTTP-Fehler! Status: ${response.status}`);
                appState.items = await response.json();
            } catch (error) {
                alert(`Fehler beim Laden des Lern-Sets: ${error.message}\n\nStelle sicher, dass die Datei '${appState.settings.itemSet}' existiert und korrekt formatiert ist.`);
                return;
            }

            if (appState.items.length === 0) {
                alert("Das ausgewählte Lern-Set ist leer.");
                return;
            }
            
            appState.currentItemIndex = 0;
            setupExerciseScreen();
            switchScreen('exercise');
            runExercise();
        }
        
        function setupExerciseScreen() {
            const isDictation = appState.mode === 'dictation';
            const isTest = appState.mode === 'test';
            buttons.showWord.classList.toggle('hidden', !isDictation);
            buttons.prevItem.classList.toggle('hidden', isTest);
            buttons.nextItem.classList.toggle('hidden', isTest);
        }

        function runExercise() {
            if (appState.testModeTimer) clearTimeout(appState.testModeTimer);
            updateItemCounter();
            if (appState.mode === 'test') runTestModeStep();
            else renderCurrentItem();
        }
        
        function runTestModeStep() {
            if (appState.currentItemIndex >= appState.items.length) {
                alert("Test beendet! Du wirst zum Startbildschirm zurückgeleitet.");
                switchScreen('start');
                return;
            }
            renderCurrentItem();
            setTimeout(playCurrentSound, appState.settings.soundDelay * 1000);
            const nextItemDelay = (appState.settings.soundDelay + 3) * 1000;
            appState.testModeTimer = setTimeout(() => {
                appState.currentItemIndex++;
                runTestModeStep();
            }, nextItemDelay);
        }

        function renderCurrentItem() {
            if (appState.items.length === 0) return;
            const item = appState.items[appState.currentItemIndex];
            appState.isShowingAnswer = false;
            exerciseElements.displayArea.innerHTML = '';
            
            if (appState.mode === 'dictation') {
                renderDictationInstructions();
                return;
            }

            const displayType = appState.settings.displayType;
            let hasImage = item.image && item.image.trim() !== '';
            let effectiveDisplayType = displayType;
            if ((displayType === 'image' || displayType === 'image_word') && !hasImage) {
                effectiveDisplayType = 'word';
            }
            
            if (effectiveDisplayType === 'image' || effectiveDisplayType === 'image_word') {
                const img = document.createElement('img');
                img.src = item.image;
                img.alt = item.name;
                img.onerror = () => {
                    img.remove();
                    const p = document.createElement('p');
                    p.className = 'word-text';
                    p.textContent = item.name;
                    exerciseElements.displayArea.appendChild(p);
                };
                exerciseElements.displayArea.appendChild(img);
            }
            
            if (effectiveDisplayType === 'word' || effectiveDisplayType === 'image_word') {
                const p = document.createElement('p');
                p.className = 'word-text';
                p.textContent = item.name;
                exerciseElements.displayArea.appendChild(p);
            }
        }

        function renderDictationInstructions() {
             buttons.showWord.classList.remove('hidden');
             exerciseElements.displayArea.innerHTML = `<div class="diktat-instructions"><p>Klicke auf den Lautsprecher, um das Wort zu hören.</p><p>Schreibe das Wort auf.</p><p>Klicke dann auf "Wort anzeigen".</p></div>`;
        }
        
        function showDictationAnswer() {
            if (appState.isShowingAnswer) return;
            const item = appState.items[appState.currentItemIndex];
            exerciseElements.displayArea.innerHTML = `<p class="word-text">${item.name}</p>`;
            buttons.showWord.classList.add('hidden');
            appState.isShowingAnswer = true;
        }

        function playCurrentSound() {
            if (appState.items.length === 0) return;
            const soundFile = appState.items[appState.currentItemIndex].sound;
            if (soundFile) {
                const audio = new Audio(soundFile);
                audio.play().catch(e => console.error("Fehler beim Abspielen des Sounds:", e));
            }
        }
        
        function showNextItem() {
            if (appState.currentItemIndex < appState.items.length - 1) {
                appState.currentItemIndex++;
                runExercise();
            }
        }
        
        function showPrevItem() {
            if (appState.currentItemIndex > 0) {
                appState.currentItemIndex--;
                runExercise();
            }
        }

        function updateItemCounter() {
            exerciseElements.itemCounter.textContent = `Item ${appState.currentItemIndex + 1} / ${appState.items.length}`;
        }
        
        function exitExercise() {
            if (appState.testModeTimer) clearTimeout(appState.testModeTimer);
            switchScreen('settings');
        }
        
        function showInstructions() {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideInstructions() {
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.9)';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // --- ANWENDUNG STARTEN ---
        initialize();
    });
    </script>
</body>
</html>
