<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Wortschatz-Trainer</title>
    
    <!-- Google Font: Comfortaa -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">

    <!-- =================================================================
         CSS STYLES (VERSION 3 - Komplettes Redesign)
         ================================================================= -->
    <style>
        /* === Globale Styles & Variablen === */
        :root {
            --primary-green: #2ecc71; /* h1-Farbe */
            --light-green: #adebad;   /* h2-Farbe */
            --primary-blue: #3498db;
            --primary-blue-hover: #2980b9;
            --secondary-color: #95a5a6;
            --dark-grey: #34495e;
            --light-grey: #ecf0f1;
            --background-color: #ffffff;
            --font-family: 'Comfortaa', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent; /* Verhindert Klick-Highlight auf Mobilger√§ten */
        }

        html, body {
            height: 100%;
            width: 100%;
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--dark-grey);
            overflow: hidden; /* Verhindert jegliches Scrollen auf der Wurzelebene */
        }
        
        /* === App-Container und Bildschirm-Logik === */
        body {
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1; /* Nimmt den verf√ºgbaren Platz ein */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            position: relative; /* Wichtig f√ºr die Positionierung der Screens */
        }

        .screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 1rem;
            background-color: var(--background-color);
            text-align: center;
            position: absolute; /* Alle Screens √ºbereinander legen */
            opacity: 1;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            visibility: visible;
        }

        .screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none; /* Klicks auf unsichtbare Screens verhindern */
        }
        
        /* === Fixierte Elemente: Logo & Hamburger Men√º === */
        .fixed-logo {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: 60px; /* Anpassen nach Bedarf */
            z-index: 1002;
            opacity: 0.7;
        }

        .hamburger-button {
            position: fixed;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            background: transparent;
            border: none;
            cursor: pointer;
            z-index: 1002;
            padding: 5px;
        }
        .hamburger-button .bar {
            width: 100%;
            height: 3px;
            background-color: var(--primary-green);
            transition: all 0.3s ease-in-out;
        }
        .hamburger-button.active .bar1 {
            transform: rotate(45deg) translate(8px, 8px);
        }
        .hamburger-button.active .bar2 {
            opacity: 0;
        }
        .hamburger-button.active .bar3 {
            transform: rotate(-45deg) translate(7px, -7px);
        }
        
        /* === Navigationsmen√º (aus dem Hamburger) === */
        .nav-menu {
            position: fixed;
            top: 0;
            right: -100%; /* Startet au√üerhalb des Bildschirms */
            width: 250px;
            height: 100%;
            background-color: rgba(52, 73, 94, 0.95); /* var(--dark-grey) mit Transparenz */
            z-index: 1001;
            transition: right 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .nav-menu.active {
            right: 0;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 1.5rem;
            padding: 1.5rem 0;
            font-weight: 700;
            cursor: pointer;
        }

        /* === Generelle UI-Komponenten === */
        h1 { margin-bottom: 0.2rem; font-size: 2.2rem; color: var(--primary-green); }
        h2 { margin-bottom: 1.5rem; font-size: 1.2rem; color: var(--light-green); font-weight: 400; }
        h3 { margin-bottom: 2rem; font-size: 1rem; color: var(--dark-grey); font-weight: 400; }
        
        .button {
            display: inline-block;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
            background-color: var(--primary-blue);
            border: none;
            border-radius: 50px; /* Pill-shape buttons */
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.2s ease, transform 0.2s ease;
            margin: 5px;
        }
        .button:hover { background-color: var(--primary-blue-hover); transform: translateY(-2px); }
        .button-secondary { background-color: var(--secondary-color); }
        .button-secondary:hover { background-color: #7f8c8d; }
        
        /* === Bildschirm 1: Modus-Auswahl (Startseite) === */
        #screen-mode-selection { justify-content: center; }
        #screen-mode-selection .title-container { margin-bottom: 2vh; }
        #screen-mode-selection .mode-tiles {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
        }

        .tile {
            flex: 1;
            max-width: 180px;
            padding: 1.5rem 1rem;
            background-color: var(--light-grey);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .tile:hover { transform: translateY(-5px); background-color: #e0e6e8; }
        .tile-emoji { font-size: 3rem; line-height: 1; margin-bottom: 1rem; }
        .tile-title { font-size: 1.1rem; font-weight: bold; }
        .tile-subtitle { display: none; } /* Untertitel sind im neuen Design redundant */

        /* === Bildschirm 2: Einstellungen === */
        #screen-settings .settings-container { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 1.5rem; }
        #settings-title { color: var(--dark-grey); margin-bottom: 2rem; }
        .setting-group { padding: 1rem; background-color: var(--light-grey); border-radius: 12px; text-align: left; }
        .setting-group label { display: block; font-weight: bold; margin-bottom: 0.5rem; }
        select, .radio-group { width: 100%; padding: 0.5rem; font-size: 1rem; border-radius: 4px; border: none; font-family: var(--font-family); }
        .radio-group label { font-weight: normal; margin-right: 1rem; }
        .slider-container { display: flex; align-items: center; gap: 1rem; }
        input[type="range"] { flex-grow: 1; }
        .navigation-buttons { margin-top: 1rem; display: flex; justify-content: space-between; width: 100%; }

        /* === Bildschirm 3: √úbung === */
        #screen-exercise { justify-content: space-between; }
        .exercise-header, .exercise-footer { width: 100%; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .exercise-main { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; overflow: hidden; padding: 1rem 0; }
        .display-area { width: 100%; height: 100%; max-height: 50vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 1rem; margin-bottom: 1rem; }
        .display-area img { max-width: 100%; max-height: 80%; object-fit: contain; margin-bottom: 1rem; }
        .display-area .word-text { font-size: 2.5rem; font-weight: bold; }
        .diktat-instructions { padding: 2rem; font-size: 1.2rem; color: var(--secondary-color); line-height: 1.6; }
        .speaker-button { font-size: 3rem; background: none; border: none; cursor: pointer; color: var(--primary-blue); transition: transform 0.2s; padding: 0.5rem; }
        .speaker-button:hover { transform: scale(1.1); }

        /* === Modal f√ºr Anleitung === */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1003; transition: opacity 0.3s, visibility 0.3s; }
        .modal-content { background: #fff; padding: 2rem; border-radius: 12px; max-width: 90%; width: 700px; max-height: 80vh; overflow-y: auto; position: relative; }
        .modal-close-button { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; background: none; border: none; cursor: pointer; color: var(--secondary-color); }
        
        /* ================================================================
           RESPONSIVE ANPASSUNGEN
           ================================================================ */
        
        /* --- Kleine Bildschirme / Portrait --- */
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1rem; }
            h3 { font-size: 0.9rem; }
            
            #screen-mode-selection .mode-tiles {
                flex-direction: column;
                gap: 1rem;
            }
            .tile { max-width: 300px; width: 80%; padding: 1rem; }
            .tile-emoji { font-size: 2rem; margin-bottom: 0.5rem; }
            
            .display-area .word-text { font-size: 1.8rem; }
            .diktat-instructions { font-size: 1rem; padding: 1rem; }
            .button { padding: 10px 18px; }
            .exercise-footer .button { font-size: 0.8rem; }
        }
        
        /* --- Sehr niedrige Bildschirme / Landscape --- */
        @media (max-height: 500px) and (orientation: landscape) {
            h1 { font-size: 1.5rem; }
            h2 { font-size: 0.9rem; margin-bottom: 1rem; }
            h3 { font-size: 0.8rem; margin-bottom: 1rem; }
            #screen-mode-selection .title-container { margin-bottom: 2vh; }

            #screen-mode-selection .mode-tiles {
                flex-direction: row;
                gap: 1rem;
            }
            .tile {
                padding: 1rem 0.5rem;
                min-width: 120px;
            }
            .tile-emoji { font-size: 1.8rem; margin-bottom: 0.5rem; }
            .tile-title { font-size: 0.9rem; }

            .exercise-main { flex-direction: row; align-items: center; gap: 1rem; padding: 0.5rem 0; }
            .display-area { max-height: 60vh; margin-bottom: 0; flex-grow: 1; }
            .speaker-button { font-size: 2.5rem; }
            .exercise-header, .exercise-footer { padding: 0.2rem 0; }
            .fixed-logo { width: 45px; }
        }

    </style>
</head>
<body>

    <button class="hamburger-button" id="hamburger-btn">
        <span class="bar bar1"></span>
        <span class="bar bar2"></span>
        <span class="bar bar3"></span>
    </button>
    
    <nav class="nav-menu" id="nav-menu">
        <a id="nav-learn">Lernmodus</a>
        <a id="nav-test">Testmodus</a>
        <a id="nav-dictation">Diktat</a>
        <a id="nav-instructions">Anleitung</a>
    </nav>

    <!-- HIER DEINEN LOGO-PFAD EINTRAGEN -->
    <img src="path/to/your/logo.png" alt="Logo" class="fixed-logo"> 

    <main>
        <!-- BILDSCHIRM 1: MODUS-AUSWAHL -->
        <div id="screen-mode-selection" class="screen">
            <div class="title-container">
                <h1>Wortschatz-Trainer</h1>
                <h2>in Bild, Wort und Ton.</h2>
                <h3>Zischlaute</h3>
            </div>
            <div class="mode-tiles">
                <div id="select-mode-learn" class="tile">
                    <div class="tile-emoji">üìö</div>
                    <div class="tile-title">Lernen</div>
                </div>
                <div id="select-mode-test" class="tile">
                    <div class="tile-emoji">‚úÖ</div>
                    <div class="tile-title">Testen</div>
                </div>
                <div id="select-mode-dictation" class="tile">
                    <div class="tile-emoji">‚úçÔ∏è</div>
                    <div class="tile-title">Diktat</div>
                </div>
            </div>
        </div>

        <!-- BILDSCHIRM 2: EINSTELLUNGEN -->
        <div id="screen-settings" class="screen hidden">
            <h1 id="settings-title">Einstellungen</h1>
            <div class="settings-container">
                <div class="setting-group">
                    <label for="item-set-select">1. Lern-Set ausw√§hlen:</label>
                    <select id="item-set-select"></select>
                </div>
                <div id="setting-display-type" class="setting-group">
                    <label>2. Anzeige-Typ:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="displayType" value="image" checked> Nur Bild</label>
                        <label><input type="radio" name="displayType" value="word"> Nur Wort</label>
                        <label><input type="radio" name="displayType" value="image_word"> Bild mit Wort</label>
                    </div>
                </div>
                <div id="setting-sound-delay" class="setting-group">
                    <label for="sound-delay-slider">3. Sound-Verz√∂gerung:</label>
                    <div class="slider-container">
                        <input type="range" id="sound-delay-slider" min="0" max="5" value="1" step="1">
                        <span id="sound-delay-value">1 s</span>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button id="back-to-mode-selection-btn" class="button button-secondary">Zur√ºck</button>
                    <button id="start-btn" class="button">Starten</button>
                </div>
            </div>
        </div>

        <!-- BILDSCHIRM 3: √úBUNGSBILDSCHIRM -->
        <div id="screen-exercise" class="screen hidden">
            <div class="exercise-header">
                <span id="item-counter">Item 1 / 10</span>
                <button id="exit-exercise-btn" class="button button-secondary">Beenden</button>
            </div>
            <div class="exercise-main">
                <div id="display-area" class="display-area"></div>
                <button id="speaker-btn" class="speaker-button">üîä</button>
            </div>
            <div class="exercise-footer">
                <button id="prev-item-btn" class="button">Vorheriges</button>
                <button id="show-word-btn" class="button hidden">Wort anzeigen</button>
                <button id="next-item-btn" class="button">N√§chstes</button>
            </div>
        </div>
    </main>

    <!-- MODAL F√úR ANLEITUNG -->
    <div id="instructions-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-instructions-btn" class="modal-close-button">√ó</button>
            <h2>Anleitung</h2>
            <p>Diese Anwendung hilft dir, W√∂rter und ihre Rechtschreibung zu lernen.</p>
            <h3>Modi</h3>
            <p><strong>üìö Lernmodus:</strong> Erkunde die Lern-Items in deinem eigenen Tempo. Navigiere mit den "N√§chstes"/"Vorheriges"-Buttons. Klicke auf den Lautsprecher, um das Wort zu h√∂ren.</p>
            <p><strong>‚úÖ Testmodus:</strong> Lass dir die Items automatisch nacheinander anzeigen. Der Ton wird nach einer von dir gew√§hlten Verz√∂gerung abgespielt.</p>
            <p><strong>‚úçÔ∏è Diktat-Modus:</strong> H√∂re dir ein Wort an und schreibe es auf. Klicke danach auf "Wort anzeigen", um deine Schreibweise zu kontrollieren.</p>
            <h3>Navigation</h3>
            <p>Nutze das Men√º oben rechts, um jederzeit zwischen den Modi zu wechseln oder diese Anleitung aufzurufen.</p>
        </div>
    </div>


    <!-- =================================================================
         JAVASCRIPT LOGIK
         ================================================================= -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const appState = {
            currentScreen: 'modeSelection',
            mode: null,
            settings: { itemSet: null, displayType: 'image', soundDelay: 1 },
            items: [],
            currentItemIndex: 0,
            isShowingAnswer: false,
            testModeTimer: null,
        };

        const ITEM_SETS = [
            { name: "Grundwortschatz Tiere", file: "sets/tiere.json" },
            { name: "Schwierige W√∂rter Klasse 4", file: "sets/klasse4.json" },
        ];

        // --- DOM ELEMENT REFERENZEN ---
        const screens = {
            modeSelection: document.getElementById('screen-mode-selection'),
            settings: document.getElementById('screen-settings'),
            exercise: document.getElementById('screen-exercise'),
        };
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const navMenu = document.getElementById('nav-menu');
        const modal = document.getElementById('instructions-modal');
        
        const buttons = {
            selectLearn: document.getElementById('select-mode-learn'),
            selectTest: document.getElementById('select-mode-test'),
            selectDictation: document.getElementById('select-mode-dictation'),
            backToMode: document.getElementById('back-to-mode-selection-btn'),
            start: document.getElementById('start-btn'),
            exitExercise: document.getElementById('exit-exercise-btn'),
            prevItem: document.getElementById('prev-item-btn'),
            nextItem: document.getElementById('next-item-btn'),
            showWord: document.getElementById('show-word-btn'),
            speaker: document.getElementById('speaker-btn'),
            closeInstructions: document.getElementById('close-instructions-btn'),
            nav: { 
                learn: document.getElementById('nav-learn'),
                test: document.getElementById('nav-test'),
                dictation: document.getElementById('nav-dictation'),
                instructions: document.getElementById('nav-instructions'),
            }
        };

        const settingsElements = {
            title: document.getElementById('settings-title'),
            itemSetSelect: document.getElementById('item-set-select'),
            displayTypeGroup: document.getElementById('setting-display-type'),
            soundDelayGroup: document.getElementById('setting-sound-delay'),
            soundDelaySlider: document.getElementById('sound-delay-slider'),
            soundDelayValue: document.getElementById('sound-delay-value'),
        };

        const exerciseElements = {
            displayArea: document.getElementById('display-area'),
            itemCounter: document.getElementById('item-counter'),
        };

        // --- FUNKTIONEN ---

        function switchScreen(screenId) {
            Object.keys(screens).forEach(key => {
                screens[key].classList.toggle('hidden', key !== screenId);
            });
            appState.currentScreen = screenId;
        }
        
        function toggleNavMenu() {
            hamburgerBtn.classList.toggle('active');
            navMenu.classList.toggle('active');
        }

        function closeNavMenu() {
            hamburgerBtn.classList.remove('active');
            navMenu.classList.remove('active');
        }

        function initialize() {
            populateItemSetSelector();
            addEventListeners();
            switchScreen('modeSelection');
        }
        
        function populateItemSetSelector() {
            ITEM_SETS.forEach(set => {
                const option = new Option(set.name, set.file);
                settingsElements.itemSetSelect.appendChild(option);
            });
        }
        
        function addEventListeners() {
            hamburgerBtn.addEventListener('click', toggleNavMenu);
            
            // Klick auf eine Kachel
            buttons.selectLearn.addEventListener('click', () => selectMode('learn'));
            buttons.selectTest.addEventListener('click', () => selectMode('test'));
            buttons.selectDictation.addEventListener('click', () => selectMode('dictation'));
            
            // KORREKTUR: Klicks auf Navigationslinks werden nun korrekt als anonyme Funktion √ºbergeben.
            buttons.nav.learn.addEventListener('click', () => { selectMode('learn'); closeNavMenu(); });
            buttons.nav.test.addEventListener('click', () => { selectMode('test'); closeNavMenu(); });
            buttons.nav.dictation.addEventListener('click', () => { selectMode('dictation'); closeNavMenu(); });
            buttons.nav.instructions.addEventListener('click', () => { showInstructions(); closeNavMenu(); });

            buttons.backToMode.addEventListener('click', () => switchScreen('modeSelection'));
            buttons.start.addEventListener('click', startGame);
            settingsElements.soundDelaySlider.addEventListener('input', e => {
                settingsElements.soundDelayValue.textContent = `${e.target.value} s`;
            });

            buttons.exitExercise.addEventListener('click', exitExercise);
            buttons.nextItem.addEventListener('click', showNextItem);
            buttons.prevItem.addEventListener('click', showPrevItem);
            buttons.speaker.addEventListener('click', playCurrentSound);
            buttons.showWord.addEventListener('click', showDictationAnswer);
            
            buttons.closeInstructions.addEventListener('click', hideInstructions);
            modal.addEventListener('click', e => {
                if (e.target === modal) hideInstructions();
            });
        }
        
        function selectMode(mode) {
            appState.mode = mode;
            setupSettingsScreen();
            switchScreen('settings');
        }
        
        function setupSettingsScreen() {
            const modeTitles = {
                learn: 'Lernmodus',
                test: 'Testmodus',
                dictation: 'Diktat'
            };
            settingsElements.title.textContent = modeTitles[appState.mode];
            
            const showDisplayType = appState.mode !== 'dictation';
            const showSoundDelay = appState.mode === 'test';
            
            settingsElements.displayTypeGroup.style.display = showDisplayType ? 'block' : 'none';
            settingsElements.soundDelayGroup.style.display = showSoundDelay ? 'block' : 'none';
        }

        async function startGame() {
            const selectedSetFile = settingsElements.itemSetSelect.value;
            if (!selectedSetFile) {
                alert("Bitte w√§hle zuerst ein Lern-Set aus.");
                return;
            }
            appState.settings.itemSet = selectedSetFile;
            appState.settings.displayType = document.querySelector('input[name="displayType"]:checked').value;
            appState.settings.soundDelay = parseInt(settingsElements.soundDelaySlider.value, 10);
            
            try {
                const response = await fetch(appState.settings.itemSet);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                appState.items = await response.json();
            } catch (error) {
                alert(`Fehler beim Laden des Lern-Sets: ${error.message}\nBitte √ºberpr√ºfe den Dateipfad und die Internetverbindung.`);
                return;
            }

            if (appState.items.length === 0) {
                alert("Das ausgew√§hlte Lern-Set ist leer.");
                return;
            }
            
            appState.currentItemIndex = 0;
            setupExerciseScreen();
            switchScreen('exercise');
            runExercise();
        }
        
        function setupExerciseScreen() {
            const isDictation = appState.mode === 'dictation';
            const isTest = appState.mode === 'test';
            buttons.showWord.classList.toggle('hidden', !isDictation);
            buttons.prevItem.classList.toggle('hidden', isTest);
            buttons.nextItem.classList.toggle('hidden', isTest);
        }

        function runExercise() {
            if (appState.testModeTimer) clearTimeout(appState.testModeTimer);
            updateItemCounter();
            if (appState.mode === 'test') {
                runTestModeStep();
            } else {
                renderCurrentItem();
            }
        }
        
        function runTestModeStep() {
            if (appState.currentItemIndex >= appState.items.length) {
                alert("Test beendet!");
                exitExercise();
                return;
            }
            renderCurrentItem();
            setTimeout(playCurrentSound, appState.settings.soundDelay * 1000);
            const nextItemDelay = (appState.settings.soundDelay + 3) * 1000;
            appState.testModeTimer = setTimeout(() => {
                appState.currentItemIndex++;
                runTestModeStep();
            }, nextItemDelay);
        }

        function renderCurrentItem() {
            const item = appState.items[appState.currentItemIndex];
            appState.isShowingAnswer = false;
            exerciseElements.displayArea.innerHTML = '';
            
            if (appState.mode === 'dictation') {
                renderDictationInstructions();
                return;
            }
            
            const displayType = appState.settings.displayType;
            const hasImage = item.image && item.image.trim() !== '';
            let effectiveDisplayType = displayType;
            if ((displayType === 'image' || displayType === 'image_word') && !hasImage) {
                effectiveDisplayType = 'word';
            }
            
            if (effectiveDisplayType.includes('image')) {
                const img = document.createElement('img');
                img.src = item.image;
                img.alt = item.name;
                img.onerror = () => {
                    img.remove();
                    const p = document.createElement('p');
                    p.className = 'word-text';
                    p.textContent = item.name;
                    exerciseElements.displayArea.appendChild(p);
                };
                exerciseElements.displayArea.appendChild(img);
            }
            
            if (effectiveDisplayType.includes('word')) {
                const p = document.createElement('p');
                p.className = 'word-text';
                p.textContent = item.name;
                exerciseElements.displayArea.appendChild(p);
            }
        }

        function renderDictationInstructions() {
             buttons.showWord.classList.remove('hidden');
             exerciseElements.displayArea.innerHTML = `<div class="diktat-instructions"><p>Wort anh√∂ren, aufschreiben & dann auf "Wort anzeigen" klicken.</p></div>`;
        }
        
        function showDictationAnswer() {
            if (appState.isShowingAnswer) return;
            const item = appState.items[appState.currentItemIndex];
            exerciseElements.displayArea.innerHTML = `<p class="word-text">${item.name}</p>`;
            buttons.showWord.classList.add('hidden');
            appState.isShowingAnswer = true;
        }

        function playCurrentSound() {
            if (!appState.items.length) return;
            const soundFile = appState.items[appState.currentItemIndex].sound;
            if (soundFile) new Audio(soundFile).play().catch(e => console.error("Sound error:", e));
        }
        
        function showNextItem() {
            if (appState.currentItemIndex < appState.items.length - 1) {
                appState.currentItemIndex++;
                runExercise();
            }
        }
        
        function showPrevItem() {
            if (appState.currentItemIndex > 0) {
                appState.currentItemIndex--;
                runExercise();
            }
        }

        function updateItemCounter() {
            exerciseElements.itemCounter.textContent = `Item ${appState.currentItemIndex + 1} / ${appState.items.length}`;
        }
        
        function exitExercise() {
            if (appState.testModeTimer) clearTimeout(appState.testModeTimer);
            switchScreen('modeSelection');
        }
        
        function showInstructions() {
            modal.classList.remove('hidden');
        }

        function hideInstructions() {
            modal.classList.add('hidden');
        }

        initialize();
    });
    </script>
</body>
</html>
